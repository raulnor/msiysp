# MSIYSP Running Tracker 
*M.S.I.Y.S.P. ("My Sport Is Your Sport's Punishment")* is a running activity extraction and data anaylsis tool.

## Project layout

- /lib/msiysp - Elixir-based Strava data feed and core logic
- /lib/msiysp_web - Phoenix web interface (LiveView dashboards)
- /python - UV Python notebooks for exploration
- msiysp_dev.db - SQLite with WAL mode (Elixir writes, Python reads)
- ~/.config/msiysp/strava_tokens.json - Strava OAuth tokens 

## Schema

```elixir
  schema "activities" do
    field :date, :utc_datetime
    field :type, :string
    field :distance_meters, :float
    field :duration_seconds, :float
    field :name, :string
    field :strava_athlete_id, :integer
    field :strava_activity_id, :integer
  end
```

## Code Samples

Fetch a page of data from Strava:

```elixir
  def fetch_activities(params \\ %{per_page: 100}) do
    token = get_valid_token()
    
    HTTPoison.get!(
      "https://www.strava.com/api/v3/athlete/activities",
      [{"Authorization", "Bearer #{token}"}],
      params: params
    )
    |> Map.get(:body)
    |> Jason.decode!()
  end
```

Return a count of activities:

```python
import sqlite3
import pandas as pd
from pathlib import Path

db_path = db_path = Path.cwd().parent / "msiysp_dev.db"
conn = sqlite3.connect(db_path)

activities = pd.read_sql("SELECT * FROM activities", conn)
print(f"Activities: {len(activities)}")
```

Query activities in Phoenix LiveView:

```elixir
# Dashboard stats
activities = Repo.all(from a in Activity, where: a.type == "Run", order_by: [desc: a.date])

# Use Msiysp.Format module for consistent formatting
Format.time(duration_seconds)  # Returns hh:mm:ss or mm:ss
```

## Phoenix Web Interface

- Server runs on http://localhost:4001 (port 4001 to avoid conflicts)
- Routes:
  - `/` - Dashboard with running stats and recent activities
  - `/activities` - Full list of all activities
- Minimal CSS (no Tailwind/esbuild) for lightweight deployment
- LiveView for real-time updates
- Use `Msiysp.Format.time/1` for consistent time/pace formatting across the app

Start server: `mix phx.server`

## Notes

- When generating full artifacts or files, add a `Generated by ${AI_MODEL} on ${DATE}` comment near the top.
- Activity table contains a handful of non-running activities. Most queries require a `type='Run'` filter.
- Data is stored in meters and seconds. Use `Msiysp.Format.time/1` for formatting times (hh:mm:ss) and paces (mm:ss/mile).
- Visualizations use plotly not matplotlib.

## Future

- TODO: Add tags / tag parser
- TODO: Job management / realtime data import
- TODO: Support for other data sources
- TODO: Add charts/graphs to Phoenix dashboard (plotly integration)